# 📤 一键推送文章脚本使用指南

## 📋 概述

`推送文章` 脚本用于自动推送文章到 GitHub，并触发自动部署到 Cloudflare Pages/Vercel/Netlify 等平台。

---

## ✨ 功能特性

### 自动化操作

- ✅ **自动检测文章**：扫描 `docs/posts/` 目录下所有新增/修改的 `.md` 文件（已发布文章）
- ✅ **检测图片资源**：扫描 `docs/public/images/covers/`、`uploads/`、`banner/` 等目录
- ✅ **排除草稿和垃圾**：自动排除 `drafts/`、`trash/`、`docs/public/images/drafts/`
- ✅ **提取文章标题**：自动读取 markdown 文件的 frontmatter 中的 `title` 字段
- ✅ **生成提交信息**：格式化为 `Add: 文章1, 文章2, 文章3...`
- ✅ **显示统计信息**：文章数量、图片资源数量
- ✅ **执行 Git 操作**：只添加已发布内容 → `git commit` → `git push`
- ✅ **进度显示**：每个步骤都有清晰的进度提示
- ✅ **错误处理**：任何步骤失败都会中断并提示

### 用户交互

- 📊 **预览提交信息**：推送前显示将要使用的 commit message
- ❓ **确认推送**：询问用户是否继续（输入 `n` 取消）
- ✅ **结果反馈**：推送成功后提示部署信息

---

## 🚀 使用方法

### Windows 用户

#### 方法一：双击运行（推荐）
1. 在文件资源管理器中找到 `推送文章.bat`
2. 双击运行
3. 按照提示操作

#### 方法二：命令行运行
```cmd
推送文章.bat
```

### Linux/Mac 用户

#### 首次使用（添加执行权限）
```bash
chmod +x 推送文章.sh
```

#### 运行脚本
```bash
./推送文章.sh
```

---

## 📖 使用示例

### 示例 1：推送单篇文章

```bash
$ ./推送文章.sh

================================================
  📝 自动推送文章到 GitHub
================================================

🔍 检测新增/修改的文章...

  ✓ VitePress 博客搭建完整指南

🖼️  检测图片资源...
  ✓ 检测到 3 个图片资源文件

================================================
📊 统计信息:
  • 文章数量: 1 篇
  • 图片资源: 3 个
================================================

================================================
📦 提交信息预览:
------------------------------------------------
Add: VitePress 博客搭建完整指南
================================================

是否继续推送? (Y/n): y

🔄 执行 Git 操作...

[1/3] 添加文件...
✓ 文件已添加
[2/3] 提交更改...
✓ 更改已提交
[3/3] 推送到远程...
✓ 推送成功

================================================
✅ 推送成功！
================================================

📡 文章将在 1-2 分钟后自动部署
🌐 请访问你的网站查看效果
```

### 示例 2：推送多篇文章

```bash
$ ./推送文章.sh

================================================
  📝 自动推送文章到 GitHub
================================================

🔍 检测新增/修改的文章...

  ✓ AI工具推荐：10个提升生产力的神器
  ✓ 免费VPN节点分享 - 2024年11月
  ✓ Markdown写作技巧大全

🖼️  检测图片资源...
  ✓ 检测到 15 个图片资源文件

================================================
📊 统计信息:
  • 文章数量: 3 篇
  • 图片资源: 15 个
================================================

================================================
📦 提交信息预览:
------------------------------------------------
Add: AI工具推荐：10个提升生产力的神器, 免费VPN节点分享 - 2024年11月, Markdown写作技巧大全
================================================

是否继续推送? (Y/n): y

[执行推送...]
```

### 示例 3：取消推送

```bash
是否继续推送? (Y/n): n

❌ 已取消推送
```

---

## 🔧 工作原理

### 检测逻辑

脚本使用 `git status` 命令检测文件变更：
```bash
git status --short docs/posts/*.md | grep -E "^[AM].*\.md$"
```

- `A`：新增的文件
- `M`：修改的文件

### 标题提取

从 markdown 文件的 frontmatter 中提取 `title` 字段：
```bash
# 匹配格式：
title: 文章标题
title: "文章标题"
title: '文章标题'
```

### Git 操作

脚本**只添加已发布的内容**，排除草稿和垃圾箱：

**添加的内容：**
1. `docs/posts/` - 已发布的文章
2. `docs/public/images/covers/` - 封面图片
3. `docs/public/images/uploads/` - 上传的图片
4. `docs/public/images/banner/` - Banner 图片
5. `docs/.vitepress/config.mts` - 配置文件
6. `nav-config.json` - 导航配置
7. `tags-config.json` - 标签配置

**排除的内容：**
- ❌ `drafts/` - 草稿箱文章
- ❌ `trash/` - 垃圾箱文章
- ❌ `docs/public/images/drafts/` - 草稿图片

**执行流程：**
1. **git add [指定目录]**：只添加已发布内容
2. **git commit -m "..."**：提交更改
3. **git push origin main**：推送到远程 main 分支

---

## ⚠️ 注意事项

### 1. Git 配置要求

确保已配置 Git 用户信息：
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

### 2. SSH Key 或 Token

需要配置 SSH key 或 Personal Access Token 才能推送：

**SSH Key（推荐）:**
```bash
# 生成 SSH key
ssh-keygen -t ed25519 -C "your.email@example.com"

# 查看公钥
cat ~/.ssh/id_ed25519.pub

# 复制公钥到 GitHub Settings → SSH and GPG keys
```

**Personal Access Token:**
- GitHub Settings → Developer settings → Personal access tokens
- 生成 token 并配置到远程地址

### 3. 远程分支

脚本默认推送到 `origin main` 分支，如果你的主分支是 `master`，请修改脚本：
```bash
# 将 推送文章.sh 中的
git push origin main
# 改为
git push origin master
```

### 4. 文件命名

- 文章文件必须是 `.md` 扩展名
- 必须在 `docs/posts/` 目录下
- frontmatter 必须包含 `title` 字段

---

## 🐛 常见问题

### Q1: 提示 "未找到 Git 仓库"

**原因**：不在 Git 仓库目录下

**解决**：
```bash
cd /path/to/vitepress-blog-starter
./推送文章.sh
```

### Q2: 提示 "git push 失败"

**原因**：
- 网络问题
- 权限问题（未配置 SSH key）
- 远程仓库不存在

**解决**：
1. 检查网络连接
2. 配置 SSH key
3. 检查远程仓库地址：
   ```bash
   git remote -v
   ```

### Q3: 未检测到文章标题

**原因**：
- 文章缺少 `title` 字段
- frontmatter 格式错误

**解决**：
确保文章包含正确的 frontmatter：
```markdown
---
title: 你的文章标题
description: 文章描述
date: 2024-11-22
author: 作者名
---
```

### Q4: 提交信息太长

**原因**：一次推送太多文章

**解决**：
- 分批推送
- 或手动修改脚本中的 commit message 生成逻辑

---

## 🎯 最佳实践

### 1. 定期推送

建议每天固定时间推送文章，保持更新频率：
```bash
# 例如：每天晚上推送
./推送文章.sh
```

### 2. 提交前预览

可以在本地预览后再推送：
```bash
# 1. 重启开发服务器
pnpm dev

# 2. 浏览器查看效果
# http://localhost:5173

# 3. 确认无误后推送
./推送文章.sh
```

### 3. 批量发布

如果有多篇文章，建议一次性发布后统一推送：
```bash
# 在管理后台连续发布多篇文章
# 然后运行脚本一次性推送
./推送文章.sh
```

### 4. 自定义提交信息

如果需要更个性化的提交信息，可以手动执行：
```bash
git add .
git commit -m "🎉 Update: 新增3篇AI工具推荐文章"
git push origin main
```

---

## 🔗 相关链接

- [README.md](./README.md) - 项目主文档
- [CONFIGURATION.md](./CONFIGURATION.md) - 配置指南
- [启动说明.md](./启动说明.md) - 启动指南

---

## 💡 提示

- 💾 **推送前备份**：重要更改建议先备份
- 🔄 **自动部署**：推送后 1-2 分钟即可在线上看到效果
- 📱 **移动端测试**：部署后记得测试移动端显示
- 🎨 **样式检查**：确保封面图片和排版正确

---

**最后更新时间**：2025-11-22
